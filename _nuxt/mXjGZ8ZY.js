import{d as K,c as u,o as a,F as R,g as B,i as T,u as U,q as F,w as Z,a as d,h as j,b as X,k as r,t as L,e}from"./BpWfJitR.js";import{_ as Y}from"./CGr0PFFr.js";import{_ as ee}from"./CTTjgqJ3.js";import{_ as te}from"./KXl41dOH.js";import{_ as ne}from"./C5aev7Hv.js";import{_ as oe}from"./DZhYih7y.js";import{aE as re}from"./C0poz2fF.js";import{_ as J}from"./BheWnx7M.js";const ie={class:"flex flex-wrap gap-x-2"},ae=K({__name:"DialogAction",props:{action:{}},setup(S){return(x,b)=>{const A=ee,I=te,i=ne;return a(),u("div",ie,[(a(!0),u(R,null,B(x.action.StatModifications,g=>(a(),u("div",null,[T(A,{obj:g},null,8,["obj"])]))),256)),(a(!0),u(R,null,B(x.action.NPCStatModifications,g=>(a(),u("div",null,[T(I,{obj:g},null,8,["obj"])]))),256)),(a(!0),u(R,null,B(x.action.DroppedCards,g=>(a(),u("div",null,[T(i,{obj:g},null,8,["obj"])]))),256))])}}}),le=Object.assign(ae,{__name:"DialogAction"});var O=(S=>(S[S.MoveOnTo=0]="MoveOnTo",S[S.ChangeDialogScene=1]="ChangeDialogScene",S[S.ExitDialog=2]="ExitDialog",S))(O||{});const _e={class:"border-2 border-current/50 rounded-md p-4 bg-current/10"},de={class:"flex gap-2"},ue={class:"grow min-h-24 p-2 rounded-md mb-2 text-lg text-black font-bold break-words",style:{"background-color":"#cfcfab"}},se={class:""},ce={key:0,class:"text-gray-500"},ge={key:1,class:"text-gray-500"},me={class:"text-sm rounded p-2"},pe={key:0},fe={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 h-full"},Se={class:"h-full"},xe=["onClick"],De={class:"text-lg font-bold"},Ee={class:"text-sm text-gray-500 text-left"},Le={key:0,class:"text-red-500 text-center mt-2"},Ae={key:1},Ne={key:2},ke={key:3},Te={class:"max-w-full max-h-128 overflow-auto mt-4"},he=K({__name:"DialogScene",props:{id:{},wrappingWidth:{}},async setup(S){let x,b;const A=U(),I=S;let i=F(null),g=F(null),G=F("");async function C(n){if(console.log(`Loading dialog: ${n}`),!n){console.error("Dialog ID is not provided");return}g.value=(await J(Object.assign({"../../generated/dialogScene/AwakenedConfirmation.json":()=>e(()=>import("./D4q2-uHV.js"),[],import.meta.url),"../../generated/dialogScene/AwakenedTalk.json":()=>e(()=>import("./CoRJmhqU.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentBadger1.json":()=>e(()=>import("./CGAmsKiq.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentBadger2.json":()=>e(()=>import("./Ca7gJtVK.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentBear.json":()=>e(()=>import("./ZcEibph7.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentBoar.json":()=>e(()=>import("./Bs7Qp-ll.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentDoe.json":()=>e(()=>import("./BgM8R4eI.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentDuck.json":()=>e(()=>import("./DxUdMmjM.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentFox.json":()=>e(()=>import("./gb8bQSEa.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentMoontouched.json":()=>e(()=>import("./BoD74YrM.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentPartridge.json":()=>e(()=>import("./Bxb6Krlo.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentStag.json":()=>e(()=>import("./D-gFfLdK.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentWolf.json":()=>e(()=>import("./CTysh9oi.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentWolfpack.json":()=>e(()=>import("./DxxODkkh.js"),[],import.meta.url),"../../generated/dialogScene/TraderIntro.json":()=>e(()=>import("./B9WXzBEe.js"),[],import.meta.url),"../../generated/dialogScene/TraderTalk.json":()=>e(()=>import("./Davic0f1.js"),[],import.meta.url),"../../generated/dialogScene/VoidEscape.json":()=>e(()=>import("./DlrXqTuP.js"),[],import.meta.url),"../../generated/dialogScene/VoidIntro.json":()=>e(()=>import("./D8ze94GM.js"),[],import.meta.url),"../../generated/dialogScene/VoidTalk.json":()=>e(()=>import("./DsIKcowP.js"),[],import.meta.url)}),`../../generated/dialogScene/${n}.json`,5)).default,console.log(`Loaded dialog: ${n}`,g),await M(g.value.SceneLines[0].key),console.log(await q(n))}async function M(n){if(n){if(console.log(`Loading line: ${n}`),!n){console.error("Line ID is not provided");return}if(i.value=g.value.SceneLines.find(c=>c.key===n),!i.value){console.error(`Dialog line with ID ${n} not found in scene ${g.value.key}`);return}console.log(`Loaded line: ${n}`,i)}}[x,b]=Z(()=>C(I.id??"Intro")),await x,b();async function q(n){const c=new Map,s=[],y=new Set;async function W(t){if(c.has(t))return c.get(t);const o=(await J(Object.assign({"../../generated/dialogScene/AwakenedConfirmation.json":()=>e(()=>import("./D4q2-uHV.js"),[],import.meta.url),"../../generated/dialogScene/AwakenedTalk.json":()=>e(()=>import("./CoRJmhqU.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentBadger1.json":()=>e(()=>import("./CGAmsKiq.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentBadger2.json":()=>e(()=>import("./Ca7gJtVK.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentBear.json":()=>e(()=>import("./ZcEibph7.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentBoar.json":()=>e(()=>import("./Bs7Qp-ll.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentDoe.json":()=>e(()=>import("./BgM8R4eI.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentDuck.json":()=>e(()=>import("./DxUdMmjM.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentFox.json":()=>e(()=>import("./gb8bQSEa.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentMoontouched.json":()=>e(()=>import("./BoD74YrM.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentPartridge.json":()=>e(()=>import("./Bxb6Krlo.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentStag.json":()=>e(()=>import("./D-gFfLdK.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentWolf.json":()=>e(()=>import("./CTysh9oi.js"),[],import.meta.url),"../../generated/dialogScene/Dialogue_AgentWolfpack.json":()=>e(()=>import("./DxxODkkh.js"),[],import.meta.url),"../../generated/dialogScene/TraderIntro.json":()=>e(()=>import("./B9WXzBEe.js"),[],import.meta.url),"../../generated/dialogScene/TraderTalk.json":()=>e(()=>import("./Davic0f1.js"),[],import.meta.url),"../../generated/dialogScene/VoidEscape.json":()=>e(()=>import("./DlrXqTuP.js"),[],import.meta.url),"../../generated/dialogScene/VoidIntro.json":()=>e(()=>import("./D8ze94GM.js"),[],import.meta.url),"../../generated/dialogScene/VoidTalk.json":()=>e(()=>import("./DsIKcowP.js"),[],import.meta.url)}),`../../generated/dialogScene/${t}.json`,5)).default;return c.set(t,o),o}function N(t,o){return`${t}_${o}`.replace(/[^a-zA-Z0-9_]/g,"_")}async function h(t,o){var D,E,l,_,f,P,v,V,z,H;const p=N(t,o.key);if(!y.has(p)){if(y.add(p),o.PossibleAnswers&&o.PossibleAnswers.length>0)for(const m of o.PossibleAnswers){let k="";if(((D=m.NewNextLine)==null?void 0:D.NextStep)===O.ExitDialog)k=`${t}_END((结束))`;else if((l=(E=m.NewNextLine)==null?void 0:E.NextLine)!=null&&l.key){k=N(t,m.NewNextLine.NextLine.key);const $=(_=c.get(t))==null?void 0:_.SceneLines.find(Q=>Q.key===m.NewNextLine.NextLine.key);$&&await h(t,$)}else if((P=(f=m.NewNextLine)==null?void 0:f.NextScene)!=null&&P.key){const $=m.NewNextLine.NextScene.key;k=`${$}_${$}_START`,await w($)}k&&s.push(`    ${p} -- "${((v=m.Answer)==null?void 0:v[A.locale.value])||"选项"}" --> ${k}`)}if(o.NextStep){if(o.NextStep.NextStep===O.ExitDialog)s.push(`    ${p} --> ${t}_END((结束))`);else if((V=o.NextStep.NextScene)!=null&&V.key){const m=o.NextStep.NextScene.key;s.push(`    ${p} --> ${m}_${m}_START`),await w(m)}else if((z=o.NextStep.NextLine)!=null&&z.key){s.push(`    ${p} --> ${N(t,o.NextStep.NextLine.key)}`);const m=(H=c.get(t))==null?void 0:H.SceneLines.find(k=>k.key===o.NextStep.NextLine.key);m&&await h(t,m)}}}}async function w(t){var p,D,E,l;if(c.has(t)&&s.some(_=>_.includes(`subgraph ${t}`)))return;const o=await W(t);s.push(`subgraph ${t}["${((p=o.SceneTitle)==null?void 0:p[A.locale.value])||t}"]`),s.push(`    ${t}_${o.SceneLines[0].key}["${((D=o.SceneLines[0].Line)==null?void 0:D[A.locale.value])||o.SceneLines[0].key}"]`),s.push(`    ${t}_${t}_START((进入对话：${((E=o.SceneTitle)==null?void 0:E[A.locale.value])||t})) --> ${N(t,o.SceneLines[0].key)}`);for(const _ of o.SceneLines)s.push(`    ${N(t,_.key)}["${((l=_.Line)==null?void 0:l[A.locale.value])||_.key}"]`);for(const _ of o.SceneLines)await h(t,_);s.push("end"),s.push(`${t}_END((结束))`)}return s.push('%%{init: { "themeVariables": { "nodeTextMaxWidth": "400px" }}}%%'),s.push("flowchart TD"),await w(n),s.join(`
`)}return G.value=([x,b]=Z(()=>q(I.id)),x=await x,b(),x),(n,c)=>{var h,w,t,o,p,D,E;const s=Y,y=le,W=oe,N=re;return a(),u(R,null,[d("div",_e,[d("div",de,[r(g).SceneImage?(a(),X(s,{key:0,card:{key:"",icon:r(g).SceneImage.FileName},"no-link":"","no-title":""},null,8,["card"])):j("",!0),d("div",ue,[d("p",se,L(r(i).Line[n.$i18n.locale]),1),r(i).ActionToPerform.StartTrading?(a(),u("p",ce,"（"+L(n.$t("开始交易"))+"）",1)):j("",!0),((h=r(i).NextStep)==null?void 0:h.NextStep)==r(O).ExitDialog?(a(),u("p",ge,"（"+L(n.$t("结束对话"))+"）",1)):j("",!0)])]),d("div",me,[T(y,{action:r(i).ActionToPerform},null,8,["action"])]),r(i).PossibleAnswers.length>0?(a(),u("div",pe,[d("div",fe,[(a(!0),u(R,null,B(r(i).PossibleAnswers,l=>(a(),u("div",Se,[d("div",{class:"h-full text-center border-2 border-current/50 rounded-md p-3 inline-block w-auto max-w-full w-full hover:bg-current/50 cursor-pointer",onClick:_=>{var f,P,v,V;return(f=l.NewNextLine.NextLine)!=null&&f.key?M((P=l.NewNextLine.NextLine)==null?void 0:P.key):(v=l.NewNextLine.NextScene)!=null&&v.key?C((V=l.NewNextLine.NextScene)==null?void 0:V.key):void 0}},[d("span",De,L(l.Answer[n.$i18n.locale]),1),d("div",Ee,[T(W,{obj:l.Conditions},null,8,["obj"]),T(y,{action:l.ActionToPerform},null,8,["action"]),l.NewNextLine.NextStep==r(O).ExitDialog?(a(),u("div",Le,[d("p",null,"（"+L(n.$t("结束对话"))+"）",1)])):j("",!0)])],8,xe)]))),256))])])):j("",!0),(w=r(i).NextStep)!=null&&w.NextLine?(a(),u("div",Ae,[d("div",{class:"text-center bg-current/10 border-2 border-current/50 rounded-md p-3 inline-block w-auto max-w-full w-full hover:bg-current/50 cursor-pointer",onClick:c[0]||(c[0]=l=>{var _,f;return M((f=(_=r(i).NextStep)==null?void 0:_.NextLine)==null?void 0:f.key)})},[d("span",null,L((r(i).NextStep.NextLine.key==((t=r(g).SceneLines[0])==null?void 0:t.key)?n.$t("返回"):(o=r(i).NextStep)==null?void 0:o.NextLine[n.$i18n.locale])||n.$t("返回")),1)])])):(p=r(i).NextStep)!=null&&p.NextScene?(a(),u("div",Ne,[d("div",{class:"text-center bg-current/10 border-2 border-current/50 rounded-md p-3 inline-block w-auto max-w-full w-full hover:bg-current/50 cursor-pointer",onClick:c[1]||(c[1]=l=>{var _,f;return C((f=(_=r(i).NextStep)==null?void 0:_.NextScene)==null?void 0:f.key)})},[d("span",null,L(((D=r(i).NextStep)==null?void 0:D.NextScene[n.$i18n.locale])||n.$t("下一段")),1)])])):!((E=r(i).NextStep)!=null&&E.NextLine)&&r(i).PossibleAnswers.length==0?(a(),u("div",ke,[d("div",{class:"text-center bg-current/10 border-2 border-current/50 rounded-md p-3 inline-block w-auto max-w-full w-full hover:bg-current/50 cursor-pointer",onClick:c[2]||(c[2]=l=>C(n.id))},[d("span",null,L(n.$t("返回")),1)])])):j("",!0)]),d("div",Te,[T(N,{code:r(G),wrappingWidth:n.wrappingWidth??100},null,8,["code","wrappingWidth"])])],64)}}}),Oe=Object.assign(he,{__name:"DialogScene"});export{Oe as _};
